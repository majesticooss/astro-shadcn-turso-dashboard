---
import SettingsPage from "@/components/routes/Settings";
import AuthenticatedLayout from "@/layouts/AuthenticatedLayout.astro";
import { auth, userCanAccessResource } from "@/lib/auth";

const session = await auth.api.getSession({
	headers: Astro.request.headers,
});

if (!session) {
	return Astro.redirect("/login");
}

if (!userCanAccessResource(session.user, Astro.url)) {
	return Astro.redirect("/unauthorized");
}
---

<AuthenticatedLayout>
	<SettingsPage client:load user={session.user} />
</AuthenticatedLayout>
